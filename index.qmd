---
title: "Utiliser OpenStreetMap avec R"
subtitle: "Goupe ElementR"
lang: "fr"
author: "Ronan Ysebaert, Louis Laurian, Timothée Giraud, Matthieu Viry"
date: "2025-05-13"
mainfont: Liberation Sans
monofont: Fira Code
date-format: "DD MMM YYYY"
format:
  revealjs: 
    theme: [default,mytheme.scss]
    highlight-style: github
    code-line-numbers: false
cache: true
title-slide-attributes: 
      data-background-image: utils/bg_first.png
      data-background-size: cover
editor_options: 
  chunk_output_type: console
---

# Déroulé

::: columns

:::: {.column width="48%"}

**(1) Utiliser OpenStreetMap pour la recherche, avec R (≈ 1h30)**

- Présentation d'OSM : spécificités, histoire, organisation, usages
- L'évaluation de la qualité d'OSM
- Principaux packages permettant d'utiliser OSM 
- Retour sur quelques cas d'usage dans les travaux du RIATE

:::: 

:::: {.column width="4%"}
::::

:::: {.column width="48%"}

**(2) Mise en pratique (≈ 1h30)**

- Une chaîne de traitements reproductible et extensible
- Géoréférencement, import de tuiles OSM et d'objets géographiques, mobilisation dans des traitements d'analyse spatiale
- *#DoItYourSelf*

::::

::: 

Une présentation à explorer ! N'hésitez pas à consulter les ressources associées à cette présentation ultérieurement. 

# Le projet OpenStreetMap 

## En quelques mots et dates

::: {.center-xy}
::: columns

:::: {.column width="48%"}

- Un projet de cartographie collaborative en ligne
- Aux origines inspiré de Wikipedia et le constat de la prédominance de données géographiques propriétaires/payantes
- Une licence (Open Data Commons Open Database License - ODbL) favorisant la libre circulation des données
- Contribution par les utilisateurs
- Souvent présenté comme une alternative à Google Maps

:::: 

:::: {.column width="4%"}
::::

:::: {.column width="48%" .fragment}

- 2004 : création par Steve Coast (University College Londres) et enregistrement du nom de domaine openstreetmap.org
- 2006 : création de la fondation OpenStreetMap (infrastructure matérielle + cadre juridique)
- 2007 : 1ère conférence State Of The Map (SOTM)
- 2010 : import du cadastre français dans un format vectoriel
- 2011 : création de l'association OpenStreetMap France
- 2012 : passage de la licence en OdbL
- 2013 : 1er SOTM France
:::: 
:::
:::


## Utilisateurs OSM

<center> 
Humm?!

Pas très utile  non ? Qui sont les registred users? toi? moi ?


![](img/registered.png){width="800px"}
<br>
<small>Source : [Wiki OSM](https://wiki.openstreetmap.org/wiki/Stats), 2025</small>

<center>


## Contributeurs

<center>

**2.2 millions** depuis le début du projet OSM. Depuis 2017, entre **250 et 300 mille** contributeurs sont actifs sur l'année. 

::: columns

:::: {.column width="50%" .medium}

**Contributeurs accumulés par mois**

![](img/contrib.png)

::::

:::: {.column width="50%" .medium}

**Contributeurs par année**

![](img/contrib_year.png)

::::

:::
<small>Source : [Wiki OSM](https://wiki.openstreetmap.org/wiki/Stats), 2025</small>
</center>


## Profil des contributeurs

On peut distinguer les **contributions individuelles** (*volunteers*), **"organisées"**, et les **imports de données** (*data imports*) issus de **sources externes**, souvent massives. 


::: columns

:::: {.column width="30%" .medium}

**Les particuliers**

- Profil type : trentenaire masculin, diplôme élevé, évoluant entre informatique et territoire et un intérêt marqué pour les cartes ([Duféal et Noucher, 2017](https://journals.openedition.org/netcom/2635))

- Motivations : couverture systématique d'un petit territoire (l'espace vécu), ou d'objets spécifiques sur un territoire plus étendu (expertise particulière), corriger des erreurs.  

- Une petite part de *mappers* réalise une grande partie du travail / une large part réalise quelques éditions (médiane du nombre de contributions = [27](https://piebro.github.io/openstreetmap-statistics/#a3ed)). Voir [cette présentation](https://2019.stateofthemap.org/attachments/7ZVYEH_sl_Mooney_a_novel_application.pdf). 


::::

:::: {.column width="5%"}
::::

:::: {.column width="30%" .medium}

**Contributions "organisées"**

- Des *[mapping parties](https://wiki.openstreetmap.org/wiki/FR:Cartoparties)* organisées régulièrement pour former des débutants et saisir de nouvelles informations dans OSM collectivement : [25 événements](https://wiki.openstreetmap.org/wiki/Current_events) proposés à travers le monde en mai 2025 ! 

- Secteur humanitaire : 60.5 million de bâtiments et 4.5 million de routes cartographiées depuis 2008 ([Herfort et al., 2021](https://doi.org/10.1038/s41598-021-82404-z)), voir projet [Missing Maps](https://www.missingmaps.org/)

- Acteurs institutionnels et industriels ([Hayat, 2019](https://theses.hal.science/tel-03117730v1/file/HAYAT_Flora_va2.pdf))


::::

:::: {.column width="5%"}
::::

:::: {.column width="30%" .medium}

**Import de données externes**

- Par des institutions, des gouvernements ou des compagnies/des organisations 

- Des routes, des limites administratives, des objets spécifiques (arbres, hôpitaux). Voir le [cataloque](https://wiki.openstreetmap.org/wiki/Import/Catalogue).  

- Controversé : 
    - progression complétude et intérêt d'usage de la base ++
    - qualité inégale, maintenance requise, mauvaise influence sur la communauté ([Witt, Loos, Zipf, 2021](https://doi.org/10.3390/ijgi10080528))

::::

:::



## Une base de donnée évolutive

<center>
<img src="img/comparaison.png" />
<small>
Source: OSM Then and Now (devenu [OpenStreetMap Vintage Tile Server](https://github.com/mvexel/openstreetmap-vintage-tile-server))
</small>

</center>

## Les données OSM par pays en 2025

<center>[Geofabrik](https://download.geofabrik.de/) permet de télécharger les données OSM par région géographique</center>

```{r}
library(rnaturalearth)
library(mapsf)
library(sf)

# Import data
world <- ne_countries(scale = "small") 
df <- read.csv("docs/geofabrik_size_country.csv", dec = ",")


# Join and data handling
world <- merge(world[,c("adm0_a3_fr", "pop_est")], df, by.x = "adm0_a3_fr", by.y = "adm0_a3", all.x = TRUE)
world <- world[world$adm0_a3_fr  != "ATA",]
world <- st_transform(world, "+proj=bertin1953")

world <- aggregate(world[,c("pop_est", "Size_2025_OSM")], by = list(world$adm0_a3_fr),
                   FUN = sum)
world$dens <- world$Size_2025_OSM / (world$pop_est/1000000)
world <- world[order(world$dens, decreasing = TRUE),]
world$dens_rank <- 1:nrow(world)

world <- world[order(world$Size_2025_OSM, decreasing = TRUE),]
world$size_rank <- 1:nrow(world)


# Map
mf_map(world, col = "white")
mf_map(world, var = c("Size_2025_OSM", "dens"), type = "prop_choro", pal = "YlOrRd", inches = .2,
       border = "white",
       leg_title = c("Poids du fichier\nosm.pbf (2025, Mo)", "Mo/Million d'habitants"), nbreaks = 5,
       leg_val_rnd = c(0,0))
mf_title("Masse de données OpenStreetMap à travers le monde")
mf_credits("Source : Geofabrik, 2025")
```

- **Top 3 (Masse de données par pays )** : USA (10.3 Go), Canada (5), France (4.4)
<!-- - **Top 3 (Mo / million hab)** : Féroé (2090 Mo/Million d'habitants), Groenland (295), Norvège (224) / (FR 18e, 65)  -->


# La base de données OSM

## Les objets géographiques dans OSM

::: columns

:::: {.column width="30%"}

- **node** : un noeud qui contient des données avec sa position, des métadonnées (dernières contributions, modifications) et éventuellement des *tags* sous forme de pairs *key-value*.
- **way** : une ligne avec au minimum 2 nodes. Peut se référer aussi à un polygone (une ligne qui a partage son premier et dernier point)

::::

:::: {.column width="5%"}
::::

:::: {.column width="60%"}

![](img/OpenStreetMap_data_primitives_in_iD.png)
<center><small>Source: [Wikipedia Commons](https://commons.wikimedia.org/wiki/File:OpenStreetMap_data_primitives_in_iD.png), 2025 </small></center>

:::: 

:::

- **relation** : pour regrouper des objets selon des caractéristiques communes (ligne de bus, objets inclus dans un aéroport, etc.) 

## Nodes, ways & relations dans OSM

<center>
![](img/geometry_stat.png){width="850px"}

<small>Source : [Wiki OSM](https://wiki.openstreetmap.org/wiki/Stats), 2025</small>
</center>



## Les tags OSM

::: columns

:::: {.column width="30%"}

- **Basé sur une folksonomie** : système de classification collaborative décentralisée spontanée, basé sur une indexation effectuée par des non-spécialistes 
- OSM utilise des **tags** de la forme **clé=valeur** (*key-value*) pour rajouter des informations aux objets géographiques
- proposés par la **communauté** : évolutifs, flexibles
- plusieurs tags peuvent être associés à un objet

::::

:::: {.column width="5%"}
::::

:::: {.column width="60%"}

![](img/key_value_condorcet.png)
:::: 

:::


## Wiki OSM - La référence

::: columns

:::: {.column width="28%"}

**Utile pour** :

- Visualiser les tags les plus courants utilisés/admis par la communauté
- Comprendre les attributs associés aux clés-valeurs utilisables/contribuables
- Voir les objets géographiques auxquels ils se rattachent
- Faire état des discussions/débats en cours

::::


:::: {.column width="72%"}

<center>

:::: {.panel-tabset}


### Key-values

![](img/key_value1.png)
<small>Source : [Wiki OSM, 2025](https://wiki.openstreetmap.org/wiki/FR:%C3%89l%C3%A9ments_cartographiques)</small>

### Détail
![](img/key_value2a.png)
<small>Source : [Wiki OSM, 2025](https://wiki.openstreetmap.org/wiki/FR:Tag:amenity%3Drestaurant)
</small>

### Erreurs
![](img/key_value3.png)
<small>Source : [Wiki OSM, 2025](https://wiki.openstreetmap.org/wiki/FR:Tag:amenity%3Drestaurant)
</small>

### Décision

![](img/key_value2.png)
<small>Source: [Wiki OSM, 2025](https://wiki.openstreetmap.org/wiki/FR:Key:highway)</small>


### Osmecum

![](img/osmecum.png)
<small>Source: [Wiki OSM, 2025](https://wiki.openstreetmap.org/wiki/France/Osmecum)</small>

:::: 

</center>

::::

::::


## Les principaux tags

<center>[Taginfo](https://taginfo.openstreetmap.org/keys) rassemble les informations sur les tags OSM afin  d'aider à comprendre ce qu'ils signifient et comment ils sont utilisés</center>

:::: {.panel-tabset}


### Noeuds

![](img/key_nodes.png)

### Chemins

![](img/key_ways.png)

### Relations

![](img/key_relations.png)

:::: 



# Précision, complétude et qualité

## Un incontournable des études (scientifiques) sur OSM

Du fait de l'écosystème d'OSM la question de la complétude / précision des données de la base est centrale dans les études scientifiques sur le sujet.

**Trois aspects sont régulièrement traités**, avec une abondante littérature scientifique portant généralement sur des **cas d'étude**.

- **Précision / justesse géométrique et cohérence topologique** : comparer le niveau de précision des localisations présentes dans OSM au regard de bases de données de référence / trouver des solutions pour parer aux problèmes topologiques contenus dans la base de données.

- **Complétude "brute" des données** : viser des manquements dans la base de données au regard de jeux de données externe de référence sur des zones de référence.

- **Complétude et justesse attributaire** : présence ou non des attributs. Si oui, correctement utilisés ? Cela concerne aussi l'application de méthodes correctives permettant d'améliorer la justesse attributaire (routage)

S'additionnent à cela les **métriques** (quels indicateurs ?) mobilisables pour évaluer la qualité d'OSM.

## Car...

::: columns

:::: {.column width="20%" .medium}
... La tentation est grande de produire hâtivement ce type de représentations. 

Est-ce une carte des services d'intérêt généraux ou des **contributions à OSM** ? Un point d'intérêt est-il **comparable** d'un pays à l'autre ?
:::: 

:::: {.column width="40%" .small .center}
![](img/profecy_doctors.png)
Source: [ESPON Profecy, 2025](https://archive.espon.eu/sites/default/files/attachments/D5%20Annex%203.%20Visualization%20of%20Input%20Data.pdf)
:::: 

:::: {.column width="40%"}
![](img/profecy_hospitals.png)
:::: 

:::

<small>
**Précision méthodologique apportée** : *"As there is no centralized quality assurance mechanism
implemented in the OpenStreetMap initiative, the OSM database has problems with
quality assurance with regard to the completeness and actuality of the information.
The general idea being that the local contributors at the same time ensure
completeness and actuality; however, as the number of contributors in cities and
regions, and their levels of engagement, vary substantially, the completeness and
actuality of the information cannot be guarantee"*. 
</small>


## Précision et qualité topologique / géométrique

<center>
Les études s'entendent sur le fait que la qualité du géoréférencement est plutôt bonne dans OSM (précision moins d'un mètre), avec des erreurs topologiques à considérer. 
<br>

::: columns

:::: {.column width="33%" .small}

**Corrections préalables à l'utilisation du réseau routier OSM**

![](img/topology.png)
<small>Source: [Tong et al., 2020](https://www.mdpi.com/1999-4907/11/12/1347)</small>
::::

:::: {.column width="33%" .small}
<br><br><br><br><br><br><br><br>
**Québec: évaluation de la précision géométrique du réseau OSM au regard d'une source externe de référence**

![](img/geometric_accuracy.png)

<small>Source: [Moradi et al., 2022](http://dx.doi.org/10.1139/geomat-2021-0012)</small>

:::: 

:::: {.column width="33%" .small}

**Décalage de l'emprise des bâtiments à Munich**
![](img/buildings_offsets.png)

<small>Source: [Fan et al., 2013](https://doi.org/10.1080/13658816.2013.867495)</small>

::::

:::

</center>

## Complétude des données

<center>

Évaluation de la complétude OSM au regard de **sources de données externes** réputées "fiables". 

::: columns

:::: {.column width="30%" .small}

**Précision des tags et complétude de points d'intérêt à Salzburg**

![](img/completeness_salzburg.jpg)
<small>Source: [Hennig., 2019](https://doi.org/10.4000/articulo.4296)</small>

::::

:::: {.column width="25%" .small}

**Occupation du sol en Europe**
![](img/completeness_land_use.png)
<small>Source: [Arsanjani, Fonte, 2016](https://www.jstor.org/stable/j.ctv3t5r09.24)</small>

::::

:::: {.column width="44%" .small}

**Variabilité géographique de la complétude à Londres**

![](img/completeness_london.png)
<small>Source: [Mashhadi et al., 2015](https://doi.org/10.1007/978-3-319-14280-7_7)</small>

::::

:::

</center>


## Justesse attributaire

<center>

Les études s'intéressent généralement à la complétude de tags clés et la consistance des attributs (mauvais tags, comparaison avec des bases de données de référence).

::: columns

:::: {.column width="50%" .small}

**Part des clés buildings ayant une valeur level saisie**

![](img/attribute_completeness_1.jpg){width="450px"}
::::

:::: {.column width="50%" .small}

**Part des clés buildings ayant des valeurs découragées par la communauté**

![](img/attribute_completeness_2.png)
<small>Source: [Biljecki et al., 2023](https://doi.org/10.1016/j.buildenv.2023.110295)</small> 

::::

:::

</center>


## Ohsome - Un outil fort utile !

<center>

L'outil [Ohsome](https://dashboard.ohsome.org) développé par l'[HeiGIT](https://heigit.org/) propose **plusieurs métriques** pour qualifier la qualité d'OSM dans le temps et l'espace.

::: columns

:::: {.column width="58%" .small}
![](img/ohsome_tree.png)
::::

:::: {.column width="42%" .small}

**Paris (arbres / points)**
![](img/ohsome_tree_paris.png)
**Mexico**
![](img/ohsome_tree_mexico.png)
::::

:::

</center>

## Ohsome - *Comparisons*

<center>

Comparaison à des jeux de données de référence (Microsoft Buildings, EURO)

::: columns

:::: {.column width="58%" .small}
![](img/ohsome_buildings.png)
::::

:::: {.column width="42%" .small}

**Paris (surface des bâtiments)**
![](img/ohsome_buildings_paris.png)
**Mexico**
![](img/ohsome_buildings_mexico.png)
::::

:::

</center>

## Ohsome - *Comparisons*

<center>

Comparaison à des jeux de données de référence (Microsoft Roads)

::: columns

:::: {.column width="58%" .small}
![](img/ohsome_roads.png)
::::


:::: {.column width="42%" .small}

**Paris (longueur des routes)**
![](img/ohsome_roads_paris.png)
**Mexico**
![](img/ohsome_roads_paris.png)
::::

:::

</center>

## Ohsome - *Saturation*

<center>

La saturation est atteinte si la croissance de la courbe ajustée est minimale 

::: columns

:::: {.column width="58%" .small}
![](img/ohsome_poi_saturation.png)
::::

:::: {.column width="42%" .small}

**Paris (plus d'une centaine de points d'intérêts)**
![](img/ohsome_poi_saturation_paris.png)
**Mexico**
![](img/ohsome_poi_saturation_mexico.png)
::::

:::

</center>

## Ohsome - *Currentness*

<center>

Estimation du niveau de mise à jour des données (dates des dernières contributions)

::: columns

:::: {.column width="58%" .small}
![](img/ohsome_poi_currentness.png)
::::

:::: {.column width="42%" .small}

**Paris (plus d'une centaine de points d'intérêts)**
![](img/ohsome_poi_currentness_paris.png)
**Mexico**
![](img/ohsome_poi_currentness_mexico.png)
::::

:::

</center>

## Ohsome - *Attribute completeness*

<center>
Évaluation de la complétude de tags centraux

::: columns

:::: {.column width="58%" .small}
![](img/ohsome_roads_maxspeed.png)
::::

:::: {.column width="42%" .small}

**Paris (part des routes ayant le tag *maxspeed* saisi)**
![](img/ohsome_roads_maxspeed_paris.png)
**Mexico**
![](img/ohsome_roads_maxspeed_mexico.png)
::::

:::

</center>


## Les aspects récurrents

- La qualité et la complétude augmente avec le temps
- Justesse/qualité dans les zones densément peuplées plus fortes 
- Réseau plutôt de bonne qualité
- Variabilité en fonction des pays
- Le caractère ouvert des contributions OSM génère *de facto* des erreurs volontaires ([vandalisme](https://wiki.openstreetmap.org/wiki/FR:Vandalisme)) ou non (tags fantaisistes, erreurs topologiques, etc.), à considérer


## Des outils collaboratifs pour améliorer la qualité d'OSM

<center>

[Osmose](https://osmose.openstreetmap.fr) est un des [nombreux outils](https://wiki.openstreetmap.org/wiki/FR:Assurance_qualit%C3%A9) qualité dédié au signalement de problèmes dans les données OSM

![](img/osmose.png){width="850px"}
</center>

# Interroger OSM avec R

## Géocodage

<br>
<center>![](img/r_packages_geocoding.png){width="800px"}</center>

## Import de données OSM

<br>
<center>![](img/r_packages_extract_objects.png){width="800px"}</center>

## Import tuiles raster et couches d'habillage carto

<br>
<center>![](img/r_packages_map_templates_static.png){width="800px"}</center>

## Carto interactive (tuiles OSM)

<br>
<center>![](img/r_packages_map_templates_interactive.png){width="800px"}</center>

## Calcul d'itinéraires

<br>
<center>![](img/r_packages_map_routing.png){width="800px"}</center>

## Développés et maintenus par le RIATE

<br>
<center>![](img/r_packages_riate.png){width="800px"}</center>


## Un restaurant Thaï dans le secteur ? 

**[tidygeocoder](https://jessecambon.github.io/tidygeocoder/)** (Cambon, 2025) : permet d'enrichir des données à partir de services de géocodage (Geocodio, Mapbox, HERE, TomTom, etc.) dont l'API [Nominatim](https://nominatim.org/) qui utilise les adresses OSM

<br>

::: columns

:::: {.column width="60%"}

```{r}
#| echo: true
#| eval: false

library(tidygeocoder)
library(sf)
library(mapsf)

# Créer un dataframe avec les adresses
here <- data.frame(address = "Recherche Sud, 93300 Aubervilliers")
here <- geocode(.tbl = here, address = "address", quiet = TRUE) |>
  st_as_sf(coords = c("long", "lat"), crs = 4326)
here
```

::::

:::: {.column width="40%"}

```{r}
#| warning: false
#| message: false
#| echo: false

library(tidygeocoder)
library(sf)
library(mapsf)

# Créer un dataframe avec les adresses
here <- data.frame(address = "Recherche Sud, 93300 Aubervilliers")
here <- geocode(.tbl = here, address = "address", quiet = TRUE) |>
  st_as_sf(coords = c("long", "lat"), crs = 4326)
here
```

:::: 

:::

## Un restaurant Thaï dans le secteur ? 

**[maposm](https://github.com/riatelab/maposm)** (Giraud, 2025) permet d'extraire des informations vectorielles (bâtiments, couverture du sol, infrastructures de transport), d'OSM à des fins cartographiques.  

<br>

::: columns

:::: {.column width="60%"}

```{r}
#| echo: true
#| eval: false

library(maposm)

# Télécharger, combiner et simplifier les couches géographiques
res <- om_get(x = c(st_coordinates(here)[1],
                    st_coordinates(here)[2]),
              r = 2000)
```

:::: 

:::: {.column width="40%"}

```{r}
#| fig-width: 5
#| fig-height: 5

library(maposm)

# Télécharger, combiner et simplifier les couches géographiques
res <- om_get(x = c(st_coordinates(here)[1],
                    st_coordinates(here)[2]),
              r = 2000)
```
::::

:::

## Un restaurant Thaï dans le secteur ? 

**[maposm](https://github.com/riatelab/maposm)** (Giraud, 2025) permet d'extraire des informations vectorielles (bâtiments, couverture du sol, infrastructures de transport), d'OSM à des fins cartographiques.  

<br>

::: columns

:::: {.column width="60%"}

```{r}
#| echo: true
#| eval: false

library(maposm)

# Télécharger, combiner et simplifier les couches géographiques
res <- om_get(x = c(st_coordinates(here)[1],
                    st_coordinates(here)[2]),
              r = 2000)

# En faire la carte
om_map(res, title = "A 2000 mètres d'ici")
mf_map(st_transform(here, 3857), add = TRUE)
```

:::: 

:::: {.column width="40%"}

```{r}
#| fig-width: 5
#| fig-height: 5

# En faire la carte
om_map(res, title = "A 2000 mètres d'ici")
mf_map(st_transform(here, 3857), add = TRUE)
```
::::

:::


## Un restaurant Thaï dans le secteur ? 

**[osmdata](https://github.com/ropensci/osmdata)** (Padgham, 2023) permet d'importer des objets vectoriels d'OSM à partir du serveur [overpass](https://overpass-api.de/). Pour des requêtes nombreuses ou volumineuses, préférez le package **[osmextract](https://github.com/ropensci/osmextract)** (Gilardi, 2025).

<br>

::: columns

:::: {.column width="60%"}

```{r}
#| echo: true
#| eval: false

# Extraire les restos thai
library(osmdata)

# Zone de recherche
zone <- res$zone
q <- opq(bbox = st_bbox(st_transform(res$zone, 4326)))

# Construire la requête
req <- add_osm_feature(opq = q, key = 'amenity', value = "restaurant")

# L'exécuter
output <- osmdata_sf(req)

# Gestion des données et ajout à la carte
restos <- output$osm_points
thai <- restos[restos$cuisine %in% "thai",]

# Résultat
om_map(res, title = "A 2000 mètres d'ici")
mf_map(st_transform(here, 3857), add = TRUE)
mf_map(st_transform(thai, 3857), pch = 21, bg = "red",  add = TRUE)
```

::::

:::: {.column width="40%"}

```{r}
#| fig-width: 5
#| fig-height: 5

# Extraire les restos thai
library(osmdata)

# Zone de recherche
zone <- res$zone
q <- opq(bbox = st_bbox(st_transform(res$zone, 4326)))

# Construire la requête
req <- add_osm_feature(opq = q, key = 'amenity', value = "restaurant")

# L'exécuter
output <- osmdata_sf(req)

# Gestion des données et ajout à la carte
restos <- output$osm_points
thai <- restos[restos$cuisine %in% "thai",]

# Résultat
om_map(res, title = "A 2000 mètres d'ici")
mf_map(st_transform(here, 3857), add = TRUE)
mf_map(st_transform(thai, 3857), pch = 21, bg = "red",  add = TRUE)
```

::::

:::

## Un restaurant Thaï dans le secteur ? 

**[osrm](https://github.com/riatelab/osrm)** (Giraud, 2024) permet l'interface entre R et le service de routage [OSRM](https://project-osrm.org/) et d'exporter routes, isochrones et matrices de distance à pieds/vélo/voiture. Pour des requêtes nombreuses, créer [sa propre instance OSRM](https://rcarto.github.io/posts/build_osrm_server/) pour ne pas surcharger le serveur de démo.

::: columns

:::: {.column width="60%"}

```{r}
#| echo: true
#| eval: false

library(osrm)

# Calcul de routes à pieds
routes <- list()
o <- data.frame(X = st_coordinates(here)[, 1],
                Y = st_coordinates(here)[, 2])
row.names(o) <- 1
for(i in 1:nrow(thai)){
  routes[[i]] <- osrmRoute(src = o,
                           dst = thai[i,],
                           overview = "full",
                           osrm.profile = 'foot')
}
routes <- do.call(rbind, routes)

# Récupérer les temps et distances de trajet
thai <- merge(thai, 
              st_set_geometry(routes, NULL),
              by.x = "osm_id", by.y = "dst")
thai$label <- paste0(round(thai$distance, 2), " km / ",
                     round(thai$duration, 2), " mn")

om_map(res, title = "A 2000 mètres d'ici")
mf_map(st_transform(routes, 3857), lwd = 2, add = TRUE)
mf_map(st_transform(here, 3857), add = TRUE)
mf_map(st_transform(thai, 3857), pch = 21, bg = "red",  add = TRUE)
mf_label(st_transform(thai, 3857), var = "label", pos = 2)
```

::::

:::: {.column width="40%"}

```{r}
#| fig-width: 5
#| fig-height: 5

library(osrm)

# Extraire les routes à partir de l'origine et des destinations
routes <- list()
o <- data.frame(X = st_coordinates(here)[, 1],
                Y = st_coordinates(here)[, 2])
row.names(o) <- 1
for(i in 1:nrow(thai)){
  routes[[i]] <- osrmRoute(src = o,
                           dst = thai[i,],
                           overview = "full",
                           osrm.profile = 'foot')
}
routes <- do.call(rbind, routes)

# Récupérer les temps et distances de trajet
thai <- merge(thai, 
              st_set_geometry(routes, NULL),
              by.x = "osm_id", by.y = "dst")
thai$label <- paste0(round(thai$distance, 2), " km / ",
                     round(thai$duration, 2), " mn")

# Carto
om_map(res, title = "A 2000 mètres d'ici")
mf_map(st_transform(routes, 3857), lwd = 2, add = TRUE)
mf_map(st_transform(here, 3857), add = TRUE)
mf_map(st_transform(thai, 3857), pch = 21, bg = "red",  add = TRUE)
mf_label(st_transform(thai, 3857), var = "label", pos = 2)
```

::::

:::

## D'autres restaurants plus proches ?

**[leaflet](https://rstudio.github.io/leaflet/)** (Cheng, 2024) permet de créer des cartes interactives en utilisant la librairie JavaScript éponyme. Elles incluent plusieurs [tuiles de référence](https://leaflet-extras.github.io/leaflet-providers/preview/index.html) à différents niveaux de zoom, dont OSM (défaut).

<br>

::: columns

:::: {.column width="50%"}

```{r}
#| eval: false
#| echo: true

# Tous les restos avec une spécialité qui n'est ni brasserie ni cuisine française
restos <- restos[!is.na(restos$cuisine) & 
                   !restos$cuisine %in% c("brasserie", "french"),]

library(leaflet)

# Carte interactive
m <- leaflet(st_transform(zone, "EPSG:4326")) %>%
  addTiles() %>%
  addPolygons() %>%
  addMarkers(data = restos, 
             popup = paste0("<b>", restos$name, "</b><br>",
                            restos$cuisine))
m
```

:::: 

:::: {.column width="50%"}

```{r}
#| fig-width: 5
#| fig-height: 5

# Tous les restos avec une spécialité qui n'est ni brasserie ni cuisine française
restos <- restos[!is.na(restos$cuisine) & 
                   !restos$cuisine %in% c("brasserie", "french"),]

# Un icone pour notre emplacemment
library(leaflet)
pirate = makeIcon(
    "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Maki2-danger-24.svg/240px-Maki2-danger-24.svg.png",
    70, 70
  )

# Carte interactive
m <- leaflet(st_transform(zone, "EPSG:4326")) %>%
  addTiles() %>%
  addPolygons() %>%
  addMarkers(data = here, icon = pirate) %>%
  addMarkers(data = restos, 
             popup = paste0("<b>", restos$name, "</b><br>",
                            restos$cuisine))
m
```
::::
 
:::


# Les usages d'OSM au RIATE

*Sélection (non exhaustive) de 10 ans de projets et études*


## Une typologie des territoires frontaliers (CGET, 2016)

<center>

**Complémentarité des territoires frontaliers** à partir d'une typologie basée sur des données socio-économiques "classiques" (Eurostat) 

![](img/cget16_01.png){width="650px"}

</center>

## Une typologie des territoires frontaliers (CGET, 2016)

<center>
Création d'indicateurs pour qualifier l'**accessibilité** des des territoires frontaliers à partir d'OSM : **points de passages frontaliers**

![](img/cget16_02.png){width="750px"}
</center>

## Une typologie des territoires frontaliers (CGET, 2016)

<center>
Création d'indicateurs pour qualifier l'**accessibilité** des des territoires frontaliers à partir d'OSM : **temps de parcours entre deux régions frontalières**

![](img/cget16_03.png){width="650px"}

</center>

## Une typologie des territoires frontaliers (CGET, 2016)

<center>

Création d'indicateurs pour qualifier l'**accessibilité** des des territoires frontaliers à partir d'OSM : **performance du réseau routier**

![](img/cget16_04.png){width="650px"}

</center>


## Une typologie des territoires frontaliers (CGET, 2016)

<center>

Une étude qui a conclu que les territoires au profil de **complémentarité favorable** sont significativement **mieux reliés entre eux** 

![](img/cget16_05.png)

:::: {.medium}
**En savoir plus ?** Voir le dépôt [HAL](https://hal.science/hal-03610513) (rapport final, présentation de synthèse et rapports techniques)
:::: 

</center>

## Des centralités frontalières avec OSM ? (CGET, 2020)

<center>
Sélectionner des équipements marqueurs de centralité à partir du wiki OSM

![](img/cget20_01.png)
</center>

## Des centralités frontalières avec OSM ? (CGET, 2020)

<center>

Comparaison française BPE/OSM pour discuter de la **complétude** de ces POI

</center>

::: columns

:::: {.column width="65%"}

![](img/cget20_02.png)

:::: 


:::: {.column width="35%"}
![](img/cget20_03a.png)
![](img/cget20_03b.png)
:::: 

::: 


## Des centralités frontalières avec OSM ? (CGET, 2020)

<center>
Comparaison transfrontalière population/OSM pour discuter de la **complétude** de ces POI

![](img/cget20_04.png)

</center>

## Des centralités frontalières avec OSM ? (CGET, 2020)

<center>

Proposer des méthodes d'**analyse spatiale** pour identifier les **pôles locaux** de centralité malgré une complétude disparate : rapports de potentiel gaussiens à différentes portées

::: columns

:::: {.column width="50%"}

![](img/cget20_06.png)

:::: 

:::: {.column width="50%"}

![](img/cget20_07.png)

:::: 

::: 

:::: {.medium}
**En savoir plus ?** Voir le [Rapport final](https://hal.science/hal-03587237/document) et son [Site Web](https://rcarto.gitpages.huma-num.fr/centralite/) associé
::::

</center>

## Comparaison potentiel euclidien / fonctionnel (2017)

<center>

Approche multi-échelle de potentiels de population dans des **voisinages géographiques/fonctionnels**

::: columns

:::: {.column width="50%" .medium}

![](img/Pot10km.png)

::::

:::: {.column width="50%" .medium}
![](img/Pot15min.png)
::::

:::

</center>

## Comparaison potentiel euclidien / fonctionnel (2017)

<center>

Approche multi-échelle de potentiels de population dans des **voisinages géographiques/fonctionnels**

::: columns

:::: {.column width="50%" .medium}

![](img/Pot20km.png)

::::

:::: {.column width="50%" .medium}
![](img/Pot30min.png)
::::

:::

</center>

## Comparaison potentiel euclidien / fonctionnel (2017)

<center>

Approche multi-échelle de potentiels de population dans des **voisinages géographiques/fonctionnels**

::: columns

:::: {.column width="50%" .medium}

![](img/Pot40km.png)

::::

:::: {.column width="50%" .medium}

![](img/Pot60min.png)
::::

:::

:::: {.medium}
**En savoir plus ?** Voir [la présentation](https://mthh.github.io/sotm_riate)
::::
</center>

## Accessibilité aux services (2019 > 2025)

**Travaux sur les équipements de santé** : impact de fermetures d'établissements de santé, en utilisant les engin de routage qui reposent sur OSM.  

::: columns

:::: {.column width="61%" .medium}

![](img/mater.png)

::::

:::: {.column width="39%" .medium}

![](img/chiru.png)
::::

:::

:::: {.medium}
<center>**En savoir plus?** Voir [ce support](https://rcarto.gitpages.huma-num.fr/santelocal/) de formation sur l'impact des fermetures de maternité dans la Nièvre (2019) et [ce notebook](https://rysebaert.gitpages.huma-num.fr/chir-access_methodo) sur les évolutions 2000-2018 de l'accès aux services de chirurgie (2024)</center>
::::

## Accessibilité aux services (2023)

**Salles d'escalade en vélo à Paris** : Saisie d'informations dans OSM, routage en vélo / calcul d'indicateurs avec R et cartographie interactive en OJS. 

::: columns

:::: {.column width="50" .medium}

![](img/climbing_1.png)

::::

:::: {.column width="50" .medium}

![](img/climbing_2.png)
::::

:::

:::: {.medium}
<center>**En savoir plus ?** Consulter [ce notebook](https://rysebaert.github.io/climbing_paris/) et ses ressources associées</center>
:::: 


## Accessibilité aux services (Horizon Europe, 2022-2026)

Accessibilité des territoires ruraux européens aux **petites et moyennes villes** / **écoles** 

::: columns

:::: {.column width="50%"}

- 512 million de couples origine (carreaux de grille kilométriques peuplés) / destination (petites et moyennes villes)

- Mise en place d'un serveur de routage Europe entière (package [`osrm`](https://github.com/riatelab/osrm)), parallélisation ([`parallel`](https://r-universe.dev/manuals/parallel.html)), optimisation de workflows ([`targets`](https://books.ropensci.org/targets/)), création d'indicateurs d'accessibilité

- Documentation dans une série de notebooks, création d'un outil de géovisualisation

:::: 

:::: {.column width="50%"}

![](img/granular_01.png)
::::

:::

## Accessibilité aux services (Horizon Europe, 2022-2026)

Accessibilité des territoires ruraux européens aux **petites et moyennes villes** / **écoles** 

::: columns

:::: {.column width="50%"}

- 512 million de couples origine (carreaux de grille kilométriques peuplés) / destination (petites et moyennes villes)

- Mise en place d'un serveur de routage Europe entière (package [`osrm`](https://github.com/riatelab/osrm)), parallélisation ([`parallel`](https://r-universe.dev/manuals/parallel.html)), optimisation de workflows ([`targets`](https://books.ropensci.org/targets/)), création d'indicateurs d'accessibilité

- Documentation dans une série de notebooks, création d'un outil de géovisualisation

:::: 

:::: {.column width="50%"}

![](img/granular_02.png)
::::

:::


## Accessibilité aux services (Horizon Europe, 2022-2026)

Accessibilité des territoires ruraux européens aux **petites et moyennes villes** / **écoles** 

::: columns

:::: {.column width="50%"}

- 512 million de couples origine (carreaux de grille kilométriques peuplés) / destination (petites et moyennes villes)

- Mise en place d'un serveur de routage Europe entière (package [`osrm`](https://github.com/riatelab/osrm)), parallélisation ([`parallel`](https://r-universe.dev/manuals/parallel.html)), optimisation de workflows ([`targets`](https://books.ropensci.org/targets/)), création d'indicateurs d'accessibilité

- Documentation dans une série de notebooks, création d'un outil de géovisualisation

:::: 

:::: {.column width="50%"}

![](img/granular_03.png)
::::

:::


## Accessibilité aux services (Horizon Europe, 2022-2026)

Accessibilité des territoires ruraux européens aux **petites et moyennes villes** / **écoles** 

::: columns

:::: {.column width="50%"}

- 512 million de couples origine (carreaux de grille kilométriques peuplés) / destination (petites et moyennes villes)

- Mise en place d'un serveur de routage Europe entière (package [`osrm`](https://github.com/riatelab/osrm)), parallélisation ([`parallel`](https://r-universe.dev/manuals/parallel.html)), optimisation de workflows ([`targets`](https://books.ropensci.org/targets/)), création d'indicateurs d'accessibilité

- Documentation dans une série de notebooks, création d'un outil de géovisualisation

:::: 

:::: {.column width="50%"}

![](img/granular_04.png)
::::

:::


## Accessibilité aux services (Horizon Europe, 2022-2026)

Accessibilité des territoires ruraux européens aux **petites et moyennes villes** / **écoles** 

::: columns

:::: {.column width="50%"}

- 512 million de couples origine (carreaux de grille kilométriques peuplés) / destination (petites et moyennes villes)

- Mise en place d'un serveur de routage Europe entière (package [`osrm`](https://github.com/riatelab/osrm)), parallélisation ([`parallel`](https://r-universe.dev/manuals/parallel.html)), optimisation de workflows ([`targets`](https://books.ropensci.org/targets/)), création d'indicateurs d'accessibilité

- Documentation dans une série de notebooks, création d'un outil de géovisualisation

:::: 

:::: {.column width="50%"}

![](img/granular_05.png)
::::

:::


## Accessibilité aux services (Horizon Europe, 2022-2026)

Accessibilité des territoires ruraux européens aux **petites et moyennes villes** / **écoles** 

::: columns

:::: {.column width="50%"}

- 512 million de couples origine (carreaux de grille kilométriques peuplés) / destination (petites et moyennes villes)

- Mise en place d'un serveur de routage Europe entière (package [`osrm`](https://github.com/riatelab/osrm)), parallélisation ([`parallel`](https://r-universe.dev/manuals/parallel.html)), optimisation de workflows ([`targets`](https://books.ropensci.org/targets/)), création d'indicateurs d'accessibilité

- Documentation dans une série de notebooks, création d'un outil de géovisualisation

- Qualifier les écarts de temps de routage à partir de données "réelles" ([Registre des Preuves de Covoiturage](https://www.data.gouv.fr/fr/datasets/trajets-realises-en-covoiturage-registre-de-preuve-de-covoiturage/))

:::: 

:::: {.column width="50%"}
<center>
![](img/granular_06.png){width="400px"}
![](img/granular_07.png){width="400px"}
</center>

::::

:::


## Accessibilité aux services (Horizon Europe, 2022-2026)

Accessibilité des territoires ruraux européens aux **petites et moyennes villes** / **écoles** 

::: columns

:::: {.column width="50%"}

- 512 million de couples origine (carreaux de grille kilométriques peuplés) / destination (petites et moyennes villes)

- Mise en place d'un serveur de routage Europe entière (package [`osrm`](https://github.com/riatelab/osrm)), parallélisation ([`parallel`](https://r-universe.dev/manuals/parallel.html)), optimisation de workflows ([`targets`](https://books.ropensci.org/targets/)), création d'indicateurs d'accessibilité

- Documentation dans une série de notebooks, création d'un outil de géovisualisation

- Qualifier les écarts de temps de routage à partir de données "réelles" ([Registre des Preuves de Covoiturage](https://www.data.gouv.fr/fr/datasets/trajets-realises-en-covoiturage-registre-de-preuve-de-covoiturage/))

:::: 

:::: {.column width="50%"}

![](img/granular_08.png)

- Comparer temps de trajet en voiture / vélo


::::

:::

:::: {.medium}
<br><center>**En savoir plus ?** Dépôt [Zenodo](https://zenodo.org/records/14160729) (données et méthodes), outil de [géovisualisation](https://nlambert.gitpages.huma-num.fr/granular-gridviz/)</center>
::::


# Pour résumer

## Pour résumer

- OSM: Un projet vieux de 20 ans. Une **communauté** qui **grandit**, la **qualité** qui **s'améliore**, des **usages** qui se **diversifient** et des outils (extraction de données, saisie de données, routage, stylisation de tuiles raster, évaluation qualité) qui se **multiplient**
- Avoir toujours en tête les **spécificités** de cette **base de données participative** (organisations, débats, complétude) pour ne pas faire n'importe quoi 
- Un **ecosystème autour de R** (mais pas que) **fonctionnel** et qui permet de faire beaucoup de choses
- Usage du RIATE autour d'OSM :
    - développement logiciel 
    - import de POI associé à des analyses de complétude et des méthodes d'interpolation spatiale
    - utilisation du réseau et d'engins de routage dérivés d'OSM pour analyses d'accessibilité, généralement associé à des origines-destinations issus de données institutionnelles.
- **Contribuez quand c'est possible / adapté !** Voir le wiki [How to contribute](https://wiki.openstreetmap.org/wiki/How_to_contribute)

## Ressources et références utiles

<center>Une sélection pas du tout exhaustive, mais pas dénuée d'intérêt pour autant...</center> 


::: {.small}

::: columns

:::: {.column width="50%"}

**Présentation d'OSM**

- Plantin, Valentin, 2013 *[Données ouvertes et cartographie libre](https://shs.cairn.info/revue-les-cahiers-du-numerique-2013-1-page-85?lang=fr)*, Les cahiers du numérique, vol. 9, n°1
- Viry, 2016, *[Généralités autours d'OSM](https://hal.science/hal-03589030v1/file/TR_05_completude_osm.pdf)*


**Réflexion sur OSM, ses usages ses évolutions**

- Arsanjani, Zipf, Mooney, Helbich, 2015, *[OpenStreetMap in GIScience:
Experiences, Research, and Applications](https://link.springer.com/book/10.1007/978-3-319-14280-7)*, Cham, Springer
- Duféal, Noucher, 2017, *[Des TIC au TOC. Contribuer à OpenStreetMap : entre commun numérique et utopie cartographique](https://journals.openedition.org/netcom/2635)*, Netcom, 31-1/2. 
- Hayat, 2019, *[Production des biens communs numériques et usages cartographiques](https://theses.hal.science/tel-03117730)*, thèse de doctorat
- Witt, Loos, Zipf, 2021, *[Analysing the Impact of Large Data Imports in OpenStreetMap](https://doi.org/10.3390/ijgi10080528)*, International Journal of Geo-Information, 10(8), 528
- Grinberger et al., 2022, *[Bridges and Barriers: An Exploration of Engagements of the Research Community with the OpenStreetMap Community](https://www.mdpi.com/2220-9964/11/1/54)*, International Journal of Geo-Information, Vol 11
::::

:::: {.column width="50%"}

**Complétude**

- Barrington-Leigh, Millard-Ball, 2017, [The world’s user-generated road map is more than 80% complete](https://doi.org/10.1371/journal.pone.0180698), PLoS ONE 12 (8)
- Girres, Touya, 2010,  [Quality Assessment of the French OpenStreetMap Dataset](https://doi.org/10.1111/j.1467-9671.2010.01203.x), Transactions in GIS vol 14
- Hennig, 2019, *[Child- and Youth-Friendly Cities: How Does and Can Crowdmapping Support Their Development?](https://doi.org/https://doi.org/10.4000/articulo.4296)*, Journal of Urban Research 
- Novack, Vorbeck, Zipf, 2024, [An investigation of the temporality of OpenStreetMap data contribution activities](https://doi.org/10.1080/10095020.2022.2124127), Geo-spatial Information Science, vol 27

**Exemples d'utilisation avec R**

- Giraud, Pécout, 2025, [Géomatique avec R](https://rcarto.github.io/geomatique_avec_r/15_OSM.html), chapitre 15
- Giraud, 2017, [Cartographic Explorations of the OpenStreetMap Database with R](https://rcarto.github.io/caRtosm/index.html)
- Giraud, Ysebaert, Pecout, 2019, [Accessibilité et données OSM](https://rcarto.gitpages.huma-num.fr/santelocal/)
- Pecout, 2025, [Traitement et analyse de l'IG avec R](https://github.com/HuguesPecout/DEMO_GEO_R), Master I Géomatique, USSEIN
- Ysebaert, 2023, [Travel time calculation with R and data visualization with Observable](https://rysebaert.github.io/climbing_paris/)
- Ysebaert, Lambert, Marveaux, 2024, [Acquisition de données géographiques et visualisations de base](https://worldregio.github.io/geounivr2024/INT3_Importe_R.html#openstreetmap), GEO UNIV'R Tunisie

::::

::: 

:::

## {background-image="utils/bg_last.png"}

::: columns

:::: {.column width="82%"}
<br><br><br><br><br>

::: {.big}
Merci ! Questions ?
:::

Place à l'application !
<br>
![](img/AvatarMaker.png){.nostretch fig-align="center" width="200px"}

::::

:::: {.column width="18%"}
::: {.small}
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
ronan.ysebaert\@cnrs.fr\
louis.laurian\@cnrs.fr\
timothee.giraud\@cnrs.fr\
matthieu.viry\@cnrs.fr\

::: 
::::
::: 


## Vos retours...

:::: {.medium}

**Volontairement omis**

...de peur d'exploser le temps mais qui peuvent être rajoutés si cela vous semble fondamental. La plupart du temps il seront évoqués à l'oral avec renvoi vers des ressources de référence. 

- présentation des logiciels qui utilisent / diffusent des données OSM (Overpass? Geofabrik, OSRM/Valhalla, Nominatim, stadia/thunderforest, iD, JOSM, etc.)
- dans les projets RIATE, exemples d'utilisation avec KDE (restos Tim). 
- comment installer un serveur osrm

**Questions :**

- Le déroulé vous semble clair et adapté au public ? 
- Pas too much au niveau de la prez des projets RIATE ? 
- Niveau biblio, j'ai mis ce qui me semblait central/intéressant. Si vous voyez des ressources/ref incontournables, je suis preneur ! 
::::